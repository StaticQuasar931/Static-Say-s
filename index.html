<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Static Says - by StaticQuasar931</title>
  <!-- SEO & Indexing -->
  <meta name="description" content="Play Static Says – the fast-paced memory reaction game by StaticQuasar931. Inspired by Simon Says but with more shapes, colors, and speed! Try to beat your high score.">
  <meta name="keywords" content="Static Says, simon says unblocked, memory game, reaction game, color shapes, shape clicker, staticquasar931 games, static says online">

  <style>
    /********************************************************
      BASIC RESET & BODY
    *********************************************************/
    * {
      margin: 0; padding: 0; box-sizing: border-box;
      font-family: Arial, sans-serif;
    }
    body {
      background: #202020; 
      color: #fff;
      width: 100vw; 
      height: 100vh; 
      overflow: hidden;
      display: flex; 
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
    }
    a { color: #0af; text-decoration: none; }

    /********************************************************
      STATIC MENU (top-left)
    *********************************************************/
    #staticMenu {
      position: fixed; 
      top: 10px; 
      left: 10px;
      background: #222; 
      color: #fff;
      padding: 10px 15px; 
      border-radius: 8px;
      z-index: 9999;
      box-shadow: 0 0 8px rgba(0,0,0,0.6);
      animation: twinkle 2s infinite;
    }
    @keyframes twinkle {
      0%, 100% { box-shadow: 0 0 8px rgba(0,255,255,0.7); }
      50% { box-shadow: 0 0 4px rgba(0,255,255,0.2); }
    }
    #closeMenu {
      background: #444; color: #fff; 
      border: none; cursor: pointer;
      padding: 4px 8px; margin-left: 10px;
      border-radius: 4px;
    }

    /********************************************************
      SETTINGS MENU (top-right)
    *********************************************************/
    #settingsButton {
      position: fixed; 
      top: 10px; 
      right: 10px;
      background: #444; 
      color: #fff;
      border: 1px solid #666;
      padding: 8px 12px;
      border-radius: 4px;
      cursor: pointer;
      z-index: 9999;
    }
    #settingsButton:hover { background: #333; }

    /* Settings Overlay */
    #settingsOverlay {
      position: fixed; 
      top: 0; 
      left: 0;
      width: 100%; 
      height: 100%;
      background: rgba(0,0,0,0.8);
      display: none;
      align-items: center; 
      justify-content: center;
      z-index: 9999;
    }
    #settingsBox {
      background: #333; 
      padding: 20px 30px; 
      border-radius: 8px;
      width: 300px; 
      text-align: center;
      color: #fff;
    }
    .settingsRow { margin: 15px 0; }

    /********************************************************
      QR CODE (BOTTOM-LEFT) – bigger for main menu
    *********************************************************/
    #qrContainer {
      position: fixed; 
      bottom: 10px; 
      left: 10px;
      z-index: 9998;
    }
    #qrContainer img {
      width: 140px; 
      height: 140px;
      border: 2px solid #fff;
      border-radius: 8px;
    }

    /********************************************************
      GLOBAL STATS (BOTTOM-RIGHT) – bigger
    *********************************************************/
    #statsContainer {
      position: fixed; 
      bottom: 10px; 
      right: 10px;
      background: rgba(0,0,0,0.6); 
      color: #fff;
      padding: 12px 16px; 
      border-radius: 8px;
      font-size: 1rem; 
      line-height: 1.6em;
      z-index: 9998;
    }
    #statsContainer strong {
      font-size: 1.1rem;
    }

    /********************************************************
      MAIN MENU
    *********************************************************/
    #mainMenu {
      width: 100%; 
      height: 100%; 
      display: flex; 
      flex-direction: column;
      align-items: center; 
      justify-content: center;
    }
    #gameTitle {
      font-size: 4rem; 
      margin-bottom: 20px; 
      text-align: center;
      font-weight: bold;
    }
    #mapSelectContainer {
      display: flex; 
      gap: 40px; 
      margin: 30px 0;
    }
    .mapChoice {
      width: 220px; 
      height: 130px;
      background: #333; 
      color: #fff;
      display: flex; 
      justify-content: center; 
      align-items: center;
      cursor: pointer; 
      border-radius: 8px;
      box-shadow: 0 0 8px rgba(255,255,255,0.1);
      transition: transform 0.2s, background 0.2s;
      text-align: center;
      font-size: 1.2rem;
    }
    .mapChoice:hover {
      transform: scale(1.05);
      background: #444;
    }
    .mapDisabled {
      background: #555 !important;
      cursor: not-allowed;
      opacity: 0.5;
    }

    /********************************************************
      DIFFICULTY MENU
    *********************************************************/
    #difficultyMenu {
      display: none;
      width: 100%; 
      height: 100%;
      flex-direction: column; 
      align-items: center; 
      justify-content: center;
      position: relative;
    }
    #difficultyTitle {
      font-size: 3rem; 
      margin-bottom: 20px;
      text-align: center;
    }
    #difficultyNote {
      margin-bottom: 20px; 
      text-align: center;
      font-size: 1.1rem;
      line-height: 1.4em;
    }
    #difficultySelectContainer {
      display: flex; 
      flex-direction: column; 
      gap: 20px;
      text-align: center;
    }
    .difficultyChoice {
      width: 200px; 
      padding: 12px 0;
      margin: 0 auto;
      border-radius: 8px; 
      color: #fff;
      font-weight: bold; 
      cursor: pointer; 
      font-size: 1.2rem;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .difficultyChoice:hover {
      transform: scale(1.05);
      box-shadow: 0 0 8px rgba(255,255,255,0.2);
    }
    #easyBtn { background: green; }
    #mediumBtn { background: orange; }
    #hardcoreBtn {
      background: red;
      /* "Hardcore" vibe effect */
    }
    #hardcoreBtn:hover {
      animation: shake 0.3s; 
      animation-iteration-count: 1;
    }
    @keyframes shake {
      0% { transform: translate(1px, 1px) rotate(0deg); }
      20% { transform: translate(-2px, -1px) rotate(-2deg); }
      40% { transform: translate(2px, 0px) rotate(1deg); }
      60% { transform: translate(-2px, 2px) rotate(2deg); }
      80% { transform: translate(1px, -2px) rotate(-1deg); }
      100% { transform: translate(1px, 1px) rotate(0deg); }
    }

    /********************************************************
      RULES/EXPLANATION OVERLAY (WITH MAP IN BG)
    *********************************************************/
    #rulesOverlay {
      display: none;
      position: fixed; 
      top: 0; 
      left: 0;
      width: 100%; 
      height: 100%;
      background: rgba(0,0,0,0.7);
      justify-content: center; 
      align-items: center;
      z-index: 2000;
    }
    #rulesBox {
      background: #222; 
      padding: 20px 30px;
      border-radius: 10px; 
      max-width: 600px; 
      text-align: center;
    }
    #rulesBox h2 { margin-bottom: 10px; }
    #rulesBox p {
      margin: 10px 0; 
      line-height: 1.4em; 
      font-size: 1rem;
    }
    #startGameBtn {
      margin-top: 15px; 
      padding: 10px 20px;
      font-size: 1rem; 
      border: none; 
      border-radius: 6px;
      cursor: pointer; 
      color: #fff;
    }

    /********************************************************
      GAME AREA
    *********************************************************/
    #gameArea {
      display: none; /* Show when game starts */
      position: relative;
      width: 100%; 
      height: 100%;
      background: linear-gradient(135deg, #0f0f0f, #1f1f1f); /* Subtle color */
      overflow: hidden;
    }
    /* Map 1 container */
    #map1Container {
      position: absolute; 
      top: 0; 
      left: 0; 
      right: 0; 
      bottom: 0;
    }
    /* Example: We'll define multiple shapes in distinct spots */
    .map1Shape {
      position: absolute;
      width: 60px; 
      height: 60px;
      border: 2px solid #fff;
      display: flex; 
      align-items: center; 
      justify-content: center;
      font-weight: bold; 
      font-size: 1rem;
      cursor: pointer; 
      user-select: none;
      background: #333;
      border-radius: 6px; 
      text-align: center;
    }
    /* Circles override to be circular */
    .circle { border-radius: 50%; }

    /* Example positions for 12 shapes */
    #shape1  { top:  50px; left:  50px;  }
    #shape2  { top:  50px; right: 50px; }
    #shape3  { bottom: 50px; left: 50px; }
    #shape4  { bottom: 50px; right: 50px; }
    #shape5  { top:  200px; left: 30%; }
    #shape6  { top:  200px; left: 60%; }
    #shape7  { top:  300px; left: 20%; }
    #shape8  { top:  300px; left: 50%; }
    #shape9  { top:  300px; left: 80%; }
    #shape10 { bottom: 150px; left: 25%; }
    #shape11 { bottom: 150px; left: 50%; }
    #shape12 { bottom: 150px; left: 75%; }

    /********************************************************
      IN-GAME HUD
    *********************************************************/
    #inGameHUD {
      position: absolute; 
      top: 30px; 
      left: 50%; 
      transform: translateX(-50%);
      background: rgba(0,0,0,0.6); 
      padding: 10px 15px; 
      border-radius: 8px;
      text-align: center;
      min-width: 250px;
    }
    #commandText {
      font-size: 1.2rem; 
      margin-bottom: 10px;
      line-height: 1.4em;
    }
    #timeLeft {
      font-size: 1rem; 
      margin-bottom: 10px;
    }
    #scoreHUD {
      margin-top: 5px; 
      font-size: 0.95rem; 
      line-height: 1.4em;
    }
    #scoreHUD .label {
      font-weight: bold; 
      margin-right: 5px;
    }

    /********************************************************
      GAME OVER
    *********************************************************/
    #gameOverOverlay {
      display: none; 
      position: fixed; 
      top: 0; 
      left: 0;
      width: 100%; 
      height: 100%;
      background: rgba(0,0,0,0.8);
      justify-content: center; 
      align-items: center;
      z-index: 3000;
      text-align: center;
    }
    #gameOverBox {
      background: #222; 
      padding: 30px; 
      border-radius: 10px; 
      width: 320px;
    }
    #gameOverBox h2 { margin-bottom: 15px; }
    #gameOverBox button {
      background: #444; 
      color: #fff; 
      border: none;
      padding: 10px 20px; 
      cursor: pointer; 
      border-radius: 6px;
      margin: 10px;
    }
    #gameOverBox button:hover { background: #666; }
  </style>
</head>
<body>

  <!-- STATIC MENU (top-left) -->
  <div id="staticMenu">
    <a href="https://sites.google.com/view/staticquasar931/gm3z" target="_blank">More Unblocked Games by Static</a>
    <button id="closeMenu">✖</button>
  </div>

  <!-- SETTINGS BUTTON (top-right) -->
  <button id="settingsButton">Settings</button>

  <!-- SETTINGS OVERLAY -->
  <div id="settingsOverlay">
    <div id="settingsBox">
      <h3>Settings</h3>
      <div class="settingsRow">
        <label>
          <input type="checkbox" id="colorBlindToggle"> 
          Color-Blind Mode
        </label>
      </div>
      <div class="settingsRow">
        <p>Color Examples:</p>
        <p style="font-size:0.9rem; line-height:1.3em;">
          <span style="color:red;">Red</span> /
          <span style="color:green;">Green</span> /
          <span style="color:blue;">Blue</span> /
          <span style="color:orange;">Orange</span> /
          <span style="color:yellow;">Yellow</span> /
          <span style="color:purple;">Purple</span>
        </p>
      </div>
      <div class="settingsRow">
        <label for="soundSlider">Sound Volume</label><br/>
        <input type="range" id="soundSlider" min="0" max="100" value="50" />
      </div>
      <div class="settingsRow">
        <button id="shareButton">Share</button>
      </div>
      <div class="settingsRow">
        <button id="closeSettingsBtn">Close</button>
      </div>
    </div>
  </div>

  <!-- QR CODE (bottom-left) - links to your homepage -->
  <div id="qrContainer">
    <a href="https://sites.google.com/view/staticquasar931/gm3z" target="_blank">
      <img 
        src="https://res.cloudinary.com/dcsrqennd/image/upload/v1733694622/frame_1_vmv9y3.png" 
        alt="QR Code to Static's Website" 
      />
    </a>
  </div>

  <!-- STATS (bottom-right) -->
  <div id="statsContainer">
    <strong>Global Stats</strong><br/>
    Total Rounds Played: <span id="totalRoundsSpan">0</span><br/><br/>
    <strong>Easy</strong> – Rounds: <span id="easyRoundsSpan">0</span>, High: <span id="easyHighSpan">0</span><br/>
    <strong>Medium</strong> – Rounds: <span id="mediumRoundsSpan">0</span>, High: <span id="mediumHighSpan">0</span><br/>
    <strong>Hardcore</strong> – Rounds: <span id="hardcoreRoundsSpan">0</span>, High: <span id="hardcoreHighSpan">0</span>
  </div>

  <!-- MAIN MENU -->
  <div id="mainMenu">
    <div id="gameTitle">🌀 Static Says</div>
    <div id="mapSelectContainer">
      <!-- Map 1 (Enabled) -->
      <div class="mapChoice" id="map1Btn">
        <span>Map 1</span>
      </div>
      <!-- Map 2 (Coming Soon) -->
      <div class="mapChoice mapDisabled" id="map2Btn">
        <span>Map 2 (Coming Soon)</span>
      </div>
      <!-- Map 3 (Coming Soon) -->
      <div class="mapChoice mapDisabled" id="map3Btn">
        <span>Map 3 (Coming Soon)</span>
      </div>
    </div>
  </div>

  <!-- DIFFICULTY MENU (appears after selecting Map 1) -->
  <div id="difficultyMenu">
    <div id="difficultyTitle">Choose Difficulty</div>
    <div id="difficultyNote">
      <strong>Easy:</strong> 4 lives, slower speed<br/>
      <strong>Medium:</strong> 2 lives, moderate speed<br/>
      <strong>Hardcore:</strong> 1 life, fastest speed
    </div>
    <div id="difficultySelectContainer">
      <div class="difficultyChoice" id="easyBtn">EASY</div>
      <div class="difficultyChoice" id="mediumBtn">MEDIUM</div>
      <div class="difficultyChoice" id="hardcoreBtn">HARDCORE</div>
    </div>
  </div>

  <!-- RULES OVERLAY (map in background) -->
  <div id="rulesOverlay">
    <div id="rulesBox">
      <h2>How to Play "Static Says"</h2>
      <p>
        1) If the command starts with <strong>“Static says...”</strong>, <em>perform</em> it.<br/>
        2) If it does NOT, <em>do nothing</em>.<br/>
        3) Each correct action = +1 point. Lose a life if you do it wrong.<br/>
        4) Speed and lives depend on difficulty.
      </p>
      <p id="difficultyInfoText"></p>
      <button id="startGameBtn">Start Game</button>
    </div>
  </div>

  <!-- GAME AREA -->
  <div id="gameArea">

    <!-- MAP 1 -->
    <div id="map1Container">
      <!-- 12 sample shapes with distinct text/positions -->
      <div class="map1Shape" id="shape1">1</div>
      <div class="map1Shape circle" id="shape2">2</div>
      <div class="map1Shape" id="shape3">3</div>
      <div class="map1Shape circle" id="shape4">4</div>
      <div class="map1Shape" id="shape5">5</div>
      <div class="map1Shape circle" id="shape6">6</div>
      <div class="map1Shape" id="shape7">7</div>
      <div class="map1Shape" id="shape8">8</div>
      <div class="map1Shape" id="shape9">9</div>
      <div class="map1Shape circle" id="shape10">10</div>
      <div class="map1Shape" id="shape11">11</div>
      <div class="map1Shape" id="shape12">12</div>
    </div>

    <!-- In-Game HUD (Command, Timer, Score) -->
    <div id="inGameHUD">
      <div id="commandText"></div>
      <div id="timeLeft"></div>
      <div id="scoreHUD">
        <div><span class="label">Difficulty:</span> <span id="currentDifficulty">-</span></div>
        <div><span class="label">Lives:</span> <span id="livesCount">0</span></div>
        <div><span class="label">Score:</span> <span id="roundScore">0</span></div>
        <div><span class="label">High:</span> <span id="currHighScore">0</span></div>
      </div>
    </div>
  </div>

  <!-- GAME OVER OVERLAY -->
  <div id="gameOverOverlay">
    <div id="gameOverBox">
      <h2>Game Over</h2>
      <p id="gameOverMsg"></p>
      <button id="menuReturnBtn">Return to Main Menu</button>
    </div>
  </div>

  <script>
  /********************************************************
    LOCAL STORAGE SETUP
  *********************************************************/
  let defaultStats = {
    totalRounds: 0,
    easy: { roundsPlayed: 0, highScore: 0 },
    medium: { roundsPlayed: 0, highScore: 0 },
    hardcore: { roundsPlayed: 0, highScore: 0 }
  };
  let gameStats = JSON.parse(localStorage.getItem('staticSaysStats')) || defaultStats;

  function saveStatsToLocal() {
    localStorage.setItem('staticSaysStats', JSON.stringify(gameStats));
  }

  /********************************************************
    UPDATE STATS UI (BOTTOM-RIGHT)
  *********************************************************/
  function updateStatsUI() {
    document.getElementById('totalRoundsSpan').textContent = gameStats.totalRounds;
    document.getElementById('easyRoundsSpan').textContent = gameStats.easy.roundsPlayed;
    document.getElementById('easyHighSpan').textContent = gameStats.easy.highScore;
    document.getElementById('mediumRoundsSpan').textContent = gameStats.medium.roundsPlayed;
    document.getElementById('mediumHighSpan').textContent = gameStats.medium.highScore;
    document.getElementById('hardcoreRoundsSpan').textContent = gameStats.hardcore.roundsPlayed;
    document.getElementById('hardcoreHighSpan').textContent = gameStats.hardcore.highScore;
  }
  updateStatsUI();

  /********************************************************
    GLOBAL DOM ELEMENTS
  *********************************************************/
  // Main UI
  const mainMenu            = document.getElementById('mainMenu');
  const map1Btn             = document.getElementById('map1Btn');
  const map2Btn             = document.getElementById('map2Btn');
  const map3Btn             = document.getElementById('map3Btn');
  // Difficulty UI
  const difficultyMenu      = document.getElementById('difficultyMenu');
  const easyBtn             = document.getElementById('easyBtn');
  const mediumBtn           = document.getElementById('mediumBtn');
  const hardcoreBtn         = document.getElementById('hardcoreBtn');
  // Rules overlay
  const rulesOverlay        = document.getElementById('rulesOverlay');
  const rulesBox            = document.getElementById('rulesBox');
  const startGameBtn        = document.getElementById('startGameBtn');
  const difficultyInfoText  = document.getElementById('difficultyInfoText');
  // Game area
  const gameArea            = document.getElementById('gameArea');
  const inGameHUD           = document.getElementById('inGameHUD');
  const commandText         = document.getElementById('commandText');
  const timeLeftEl          = document.getElementById('timeLeft');
  const livesCountEl        = document.getElementById('livesCount');
  const roundScoreEl        = document.getElementById('roundScore');
  const currHighScoreEl     = document.getElementById('currHighScore');
  const currentDifficultyEl = document.getElementById('currentDifficulty');
  // Game over
  const gameOverOverlay     = document.getElementById('gameOverOverlay');
  const gameOverMsg         = document.getElementById('gameOverMsg');
  const menuReturnBtn       = document.getElementById('menuReturnBtn');
  // Stats & QR containers
  const qrContainer         = document.getElementById('qrContainer');
  const statsContainer      = document.getElementById('statsContainer');
  // Settings
  const settingsButton      = document.getElementById('settingsButton');
  const settingsOverlay     = document.getElementById('settingsOverlay');
  const closeSettingsBtn    = document.getElementById('closeSettingsBtn');
  const colorBlindToggle    = document.getElementById('colorBlindToggle');
  const soundSlider         = document.getElementById('soundSlider');
  const shareButton         = document.getElementById('shareButton');

  // Static Menu
  document.getElementById('closeMenu').addEventListener('click', () => {
    document.getElementById('staticMenu').style.display = 'none';
  });

  // Settings
  settingsButton.addEventListener('click', () => {
    settingsOverlay.style.display = 'flex';
  });
  closeSettingsBtn.addEventListener('click', () => {
    settingsOverlay.style.display = 'none';
  });
  shareButton.addEventListener('click', () => {
    alert("Share feature not implemented – place your link or social share code here!");
  });

  /********************************************************
    MAP SELECTION
  *********************************************************/
  // Only Map 1 is active
  map1Btn.addEventListener('click', () => {
    // Hide main menu, show difficulty menu
    mainMenu.style.display = 'none';
    difficultyMenu.style.display = 'flex';
  });
  map2Btn.addEventListener('click', () => {
    // no-op for disabled
  });
  map3Btn.addEventListener('click', () => {
    // no-op for disabled
  });

  /********************************************************
    DIFFICULTY SELECT
  *********************************************************/
  let currentDifficulty = '';
  let lives = 0;
  let roundScore = 0;
  let currentHighScore = 0;

  // Adjust speed/time limit by difficulty
  let baseTimeLimit = 3000; // default

  easyBtn.addEventListener('click', () => {
    currentDifficulty = 'easy';
    lives = 4;
    baseTimeLimit = 3000; // slower
    currentHighScore = gameStats.easy.highScore;
    showRulesOverlay("Easy Mode: 4 lives, slower speed. Best for beginners!");
  });
  mediumBtn.addEventListener('click', () => {
    currentDifficulty = 'medium';
    lives = 2;
    baseTimeLimit = 2200; // medium
    currentHighScore = gameStats.medium.highScore;
    showRulesOverlay("Medium Mode: 2 lives, moderate speed. A good challenge!");
  });
  hardcoreBtn.addEventListener('click', () => {
    currentDifficulty = 'hardcore';
    lives = 1;
    baseTimeLimit = 1500; // fastest
    currentHighScore = gameStats.hardcore.highScore;
    showRulesOverlay("Hardcore Mode: 1 life, fastest speed. Good luck!");
  });

  function showRulesOverlay(msg) {
    // Show the map background (so user can see it behind the rules)
    difficultyMenu.style.display = 'none';
    gameArea.style.display = 'block';
    rulesOverlay.style.display = 'flex';
    difficultyInfoText.textContent = msg;
  }

  // Start the game after rules
  startGameBtn.addEventListener('click', () => {
    rulesOverlay.style.display = 'none';
    startTheGame();
  });

  /********************************************************
    SHAPE DEFINITIONS (Map 1)
    Each shape: 
      id -> DOM ID
      color -> color name
      shapeType -> "square" or "circle"
      positionDesc -> "top-left corner" etc
      hasNumber -> optional number
      name -> text label for referencing in commands
  *********************************************************/
  // We'll define 12 shapes with unique combos
  const map1Shapes = [
    {
      id: "shape1",
      color: "red",
      shapeType: "square",
      positionDesc: "top-left corner",
      hasNumber: 1,
      name: "red square with the number 1 in the top-left corner"
    },
    {
      id: "shape2",
      color: "blue",
      shapeType: "circle",
      positionDesc: "top-right corner",
      hasNumber: 2,
      name: "blue circle with the number 2 in the top-right corner"
    },
    {
      id: "shape3",
      color: "green",
      shapeType: "square",
      positionDesc: "bottom-left corner",
      hasNumber: 3,
      name: "green square with the number 3 in the bottom-left corner"
    },
    {
      id: "shape4",
      color: "orange",
      shapeType: "circle",
      positionDesc: "bottom-right corner",
      hasNumber: 4,
      name: "orange circle with the number 4 in the bottom-right corner"
    },
    {
      id: "shape5",
      color: "yellow",
      shapeType: "square",
      positionDesc: "upper-left area",
      hasNumber: 5,
      name: "yellow square with the number 5 in the upper-left area"
    },
    {
      id: "shape6",
      color: "purple",
      shapeType: "circle",
      positionDesc: "upper-right area",
      hasNumber: 6,
      name: "purple circle with the number 6 in the upper-right area"
    },
    {
      id: "shape7",
      color: "red",
      shapeType: "square",
      positionDesc: "middle-left area",
      hasNumber: 7,
      name: "red square with the number 7 in the middle-left area"
    },
    {
      id: "shape8",
      color: "green",
      shapeType: "square",
      positionDesc: "center area",
      hasNumber: 8,
      name: "green square with the number 8 in the center area"
    },
    {
      id: "shape9",
      color: "blue",
      shapeType: "square",
      positionDesc: "middle-right area",
      hasNumber: 9,
      name: "blue square with the number 9 in the middle-right area"
    },
    {
      id: "shape10",
      color: "orange",
      shapeType: "circle",
      positionDesc: "lower-left area",
      hasNumber: 10,
      name: "orange circle with the number 10 in the lower-left area"
    },
    {
      id: "shape11",
      color: "purple",
      shapeType: "square",
      positionDesc: "lower-middle area",
      hasNumber: 11,
      name: "purple square with the number 11 in the lower-middle area"
    },
    {
      id: "shape12",
      color: "yellow",
      shapeType: "square",
      positionDesc: "lower-right area",
      hasNumber: 12,
      name: "yellow square with the number 12 in the lower-right area"
    }
  ];

  /********************************************************
    START THE GAME
  *********************************************************/
  let roundActive = false;
  let timerID = null;
  let timeLimit = baseTimeLimit;
  let countdownInterval = null;
  let currentRound = 0;

  function startTheGame() {
    // Hide QR code and Stats for immersion
    qrContainer.style.display = 'none';
    statsContainer.style.display = 'none';

    roundScore = 0;
    currentRound = 0;
    timeLimit = baseTimeLimit;
    
    currentDifficultyEl.textContent = currentDifficulty.toUpperCase();
    livesCountEl.textContent = lives;
    roundScoreEl.textContent = roundScore;
    currHighScoreEl.textContent = currentHighScore;
    inGameHUD.style.display = 'block';

    nextRound();
  }

  /********************************************************
    GAME ROUND
  *********************************************************/
  function nextRound() {
    roundActive = true;
    currentRound++;

    // Increase difficulty with rounds: reduce time limit a bit each round
    // but keep a floor so it doesn't get too impossible
    timeLimit = Math.max(baseTimeLimit - (currentRound * 100), 700);

    // Decide if "Static says" or not (70% chance = "Static says")
    let staticSays = (Math.random() < 0.7);

    // For easier early rounds, we might reduce the shape pool in the first few rounds
    let shapePoolSize = Math.min(4 + currentRound, map1Shapes.length);
    shapePoolSize = Math.min(shapePoolSize, map1Shapes.length);

    // Possibly multi-step commands for higher rounds
    let multiStep = 1;
    if (currentRound >= 5 && Math.random() < 0.4) {
      multiStep = 2; // two steps
    }

    // Gather random shapes
    let chosenShapes = [];
    for (let i = 0; i < multiStep; i++) {
      let randomShape = map1Shapes[Math.floor(Math.random() * shapePoolSize)];
      chosenShapes.push(randomShape);
    }

    // Build the instruction text
    let instructionText = "";
    if (staticSays) {
      instructionText += "Static says: click on ";
    } else {
      instructionText += "Click on ";
    }

    // If color-blind mode is on, we add abbreviations like (R), (G), etc.
    let isColorBlind = colorBlindToggle.checked;

    // Combine shapes into a single text
    chosenShapes.forEach((shp, idx) => {
      let colorLabel = shp.color;
      let colorAbbr = "";
      if (isColorBlind) {
        // Simple abbreviations
        if (shp.color.toLowerCase() === 'red') colorAbbr = " (R)";
        else if (shp.color.toLowerCase() === 'green') colorAbbr = " (G)";
        else if (shp.color.toLowerCase() === 'blue') colorAbbr = " (B)";
        else if (shp.color.toLowerCase() === 'orange') colorAbbr = " (O)";
        else if (shp.color.toLowerCase() === 'purple') colorAbbr = " (P)";
        else if (shp.color.toLowerCase() === 'yellow') colorAbbr = " (Y)";
      }
      let nameSegment = `${shp.color}${colorAbbr} ${shp.shapeType} with the number ${shp.hasNumber} in the ${shp.positionDesc}`;
      if (idx > 0) {
        instructionText += (idx === multiStep - 1) ? " then " : ", then ";
      }
      instructionText += nameSegment;
    });

    commandText.innerHTML = instructionText;

    // Timer
    let totalTimeSec = Math.ceil(timeLimit / 1000);
    timeLeftEl.textContent = "Time left: " + totalTimeSec + "s";

    // Start a countdown
    let timeRemaining = totalTimeSec;
    countdownInterval = setInterval(() => {
      timeRemaining--;
      if (timeRemaining <= 0) {
        clearInterval(countdownInterval);
      }
      timeLeftEl.textContent = "Time left: " + Math.max(timeRemaining, 0) + "s";
    }, 1000);

    // If user must do something but fails to do it in time => lose life
    timerID = setTimeout(() => {
      if (staticSays) {
        // Player needed to click, but didn't => fail
        finalizeRound(false);
      } else {
        // If "Static doesn't say," then doing nothing is correct => success
        finalizeRound(true);
      }
    }, timeLimit);

    // Attach shape click logic
    // If "Static says," user must click the correct shape(s) in the right order
    // For simplicity, let's say any out-of-order or wrong shape is immediate fail.
    if (staticSays) {
      let requiredClicks = chosenShapes.map(c => c.id);
      let clickIndex = 0;
      function shapeClickHandler(e) {
        if (!roundActive) return;
        const clickedId = e.target.id;
        if (clickedId === requiredClicks[clickIndex]) {
          clickIndex++;
          // If we are done, success
          if (clickIndex >= requiredClicks.length) {
            finalizeRound(true);
          }
        } else {
          // Wrong shape
          finalizeRound(false);
        }
      }
      map1Shapes.forEach(s => {
        let ref = document.getElementById(s.id);
        ref.addEventListener('click', shapeClickHandler);
      });

      // Cleanup
      function finalizeRound(success) {
        roundActive = false;
        clearTimeout(timerID);
        clearInterval(countdownInterval);

        // Remove listeners
        map1Shapes.forEach(s => {
          let ref = document.getElementById(s.id);
          ref.removeEventListener('click', shapeClickHandler);
        });
        handleRoundEnd(success);
      }
    } else {
      // "Static doesn't say," correct action is do nothing
      // If user clicks anything => fail
      function shapeClickHandler(e) {
        if (!roundActive) return;
        finalizeRound(false);
      }
      map1Shapes.forEach(s => {
        let ref = document.getElementById(s.id);
        ref.addEventListener('click', shapeClickHandler);
      });

      function finalizeRound(success) {
        roundActive = false;
        clearTimeout(timerID);
        clearInterval(countdownInterval);
        map1Shapes.forEach(s => {
          let ref = document.getElementById(s.id);
          ref.removeEventListener('click', shapeClickHandler);
        });
        handleRoundEnd(success);
      }
    }
  }

  /********************************************************
    HANDLE ROUND END
  *********************************************************/
  function handleRoundEnd(success) {
    if (success) {
      // Award point only if success
      roundScore++;
      gameStats.totalRounds++;
      gameStats[currentDifficulty].roundsPlayed++;
    } else {
      // Lost a life if we fail
      lives--;
      // No point for failing
    }
    updateStatsUI();
    saveStatsToLocal();

    // Check if game over
    if (lives <= 0) {
      endGame();
    } else {
      // Continue
      roundScoreEl.textContent = roundScore;
      livesCountEl.textContent = lives;
      nextRound();
    }
  }

  /********************************************************
    END GAME
  *********************************************************/
  function endGame() {
    // Stop everything
    roundActive = false;
    clearTimeout(timerID);
    clearInterval(countdownInterval);

    // Update high score if needed
    if (roundScore > currentHighScore) {
      currentHighScore = roundScore;
      gameStats[currentDifficulty].highScore = roundScore;
      saveStatsToLocal();
    }

    // Show game over overlay
    gameOverMsg.textContent = "Your Score: " + roundScore;
    gameOverOverlay.style.display = 'flex';
  }

  menuReturnBtn.addEventListener('click', () => {
    // Return to main menu
    gameOverOverlay.style.display = 'none';
    gameArea.style.display = 'none';
    mainMenu.style.display = 'flex';

    // Show QR & Stats again
    qrContainer.style.display = 'block';
    statsContainer.style.display = 'block';

    updateStatsUI();
  });
  </script>
</body>
</html>
